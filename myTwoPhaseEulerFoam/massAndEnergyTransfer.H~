//-----------------------------------------------------------------------------\\
// Interphase energy transfer calculation based on Barcia-Cascales et al., 2007
//
// It is a linear relaxation equation (relaxed from saturation)
//
//-----------------------------------------------------------------------------\\

// define problem specific constants
scalar Ctou = 1.0, tou = 0.00001;

// hSatV, hSatL
// hSatV = -0.000508*Foam::pow (T,4)+0.402133*Foam::pow(T,3)-121.645905*Foam::pow(T,2)+17114.230257*T-537903.887493;
//
// hSatL = 0.000491*Foam::pow(T,4)-0.397733*Foam::pow(T,3)+120.103770*Foam::pow(T,2)-14045.518453*T+449986.580984;

volScalarField& Tvap = thermo1.T();
volScalarField& Tliq = thermo2.T();
volScalarField& hVap = thermo1.he();
volScalarField& hLiq = thermo2.he();

// local variables
scalar TvapS, TliqS, hSatVs, hSatLs, hVapS, hLiqS, qVs, qLs, gammaLs, gammaVs;
int i;

for(i = 0; i < celln+1; i++)
{
	TvapS = Tvap[i];//.value();
	TliqS = Tliq[i];//.value();
	
	hSatVs = -0.000508*Foam::pow (TvapS,4)+0.402133*Foam::pow(TvapS,3)-121.645905*Foam::pow(TvapS,2)+17114.230257*TvapS-537903.887493;
	hSatLs = 0.000491*Foam::pow(TliqS,4)-0.397733*Foam::pow(TliqS,3)+120.103770*Foam::pow(TliqS,2)-14045.518453*TliqS+449986.580984;
	
	// heat transfer calculation
	hVapS = hVap[i];
	hLiqS = hLiq[i];

	qV[i] = (Ctou/tou)*alpha1[i]*(hSatVs-hVapS);
	qL[i] = (Ctou/tou)*alpha1[i]*(hSatLs-hLiqS);

	// mass transfer calculation
	qVs = qV[i];
	qLs = qL[i];
	gammaV[i] = -(qVs+qLs)/(hSatVs-hSatLs);
	gammaL[i] = -gammaV[i];

	if (TvapS>300.0 || hSatVs > hVapS)
	{
		qV[i] = 0.0;
		gammaV[i] = 0.0;
	}

	if (TliqS>300.0 || hSatLs < hLiqS)
	{
		qL[i] = 0.0;
		gammaL[i] = 0.0;
	}
	
};


Info << "gammaV = " << gammaV << nl << endl;
//Info << "hVapS = " << hVapS << nl << endl;


